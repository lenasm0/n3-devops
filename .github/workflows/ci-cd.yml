name: Continuous Integration + Continuous Delivery 
 
on: 
  push: 
    branches: 
      - develop 
  pull_request: 
    branches: 
      - develop 
 
jobs: 
  ci_cd: 
    runs-on: ubuntu-latest 
 
    steps: 
      - name: Checkout 
        uses: actions/checkout@v4 
 
      - name: Setup Node 
        uses: actions/setup-node@v4 
        with: 
          node-version: 20 
          cache: "npm" 
 
      - name: Install dependencies 
        run: npm ci 
 
      - name: Lint 
        run: npx eslint . 
 
      - name: Tests with coverage 
        run: npx jest --coverage 
 
      - name: Delivery build
        if: success()
        run: |
          echo "Gerando build interno..."
          # Nenhuma cópia para 'dist' - evitar copiar dist para dentro de si mesmo
          rm -rf dist || true
          mkdir -p dist
          # Copia apenas os arquivos necessários (exemplos); NÃO copie a própria pasta dist
          copy package.json dist\ 2>nul || type nul > dist\package.json
          copy index.js dist\ 2>nul || type nul > dist\index.js
          if exist README.md copy README.md dist\ 2>nul
          echo "Build gerado em dist/"


